<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sms">

	<select id="msgInfo" resultType="msgInfo">
		select * 
		  from v_msg_info
		 where order_no = #{orderNo}
	</select>

	<update id="autoSend" parameterType="hashmap">
		update sms_setting
		   set is_send = #{send}
			 , is_send_admin = #{sendAdmin}
		 where template_id = #{templateId}
	</update>
	
	<select id="smsCheck" resultType="smsSetting">
		select *
		  from sms_setting
		 where template_id = #{templateId}
	</select>
	
	<insert id="insertSms" parameterType="hashmap">
		insert into tb_sms (
							sms_code,
							receive_code,
							request_id,
							receive_phone,
							receive_title,
							receive_content,
							sms_point,
							receive_date)
		values(
				NEXTVAL(seq_sms_code),
				#{type},
				#{requestId},
				#{phone},
				#{title},
				#{content},
				default,
				#{date})
	</insert>	
	
	<select id="selectSmsList" resultType="sms">
		select sms_code,
			   receive_code,
			   request_id,
			   receive_phone,
			   receive_title,
			   receive_content,
			   sms_point,
			   date_format(receive_date, '%Y-%m-%d %T') as reDate
		  from tb_sms;
	</select>
  
</mapper>